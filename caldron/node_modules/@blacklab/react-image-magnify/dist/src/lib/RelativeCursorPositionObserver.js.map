{"version":3,"file":"RelativeCursorPositionObserver.js","sourceRoot":"","sources":["../../../src/lib/RelativeCursorPositionObserver.ts"],"names":[],"mappings":";;;AAMA,MAAa,8BAA8B;IAKvC,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAED,IAAI,OAAO,CAAC,KAA8B;QACtC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC1B,CAAC;IAED,IAAI,6BAA6B;QAC7B,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;SAC9D;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACrB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,gCAAgC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC7E;QAED,OAAO,IAAI,CAAC,aAAa,CAAC;IAC9B,CAAC;IAED,gCAAgC,CAAC,EAAe;QAC5C,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;QACpC,MAAM,EACF,IAAI,EAAE,OAAO,EACb,GAAG,EAAE,MAAM,GACd,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;QAEnC,MAAM,EACF,IAAI,EAAE,MAAM,EACZ,GAAG,EAAE,KAAK,GACb,GAAG,EAAE,CAAC,qBAAqB,EAAE,CAAC;QAE/B,OAAO;YACH,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,MAAM;YAC7B,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,KAAK;SAC9B,CAAC;IACN,CAAC;IAED,WAAW,CAAC,EAAe;QACvB,IAAI,EAAE,CAAC,aAAa,EAAE;YAClB,OAAO,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,aAAa,CAAC,CAAC;SAC7C;QACD,OAAO,EAAE,CAAC;IACd,CAAC;IAED,wCAAwC,CACpC,KAAyB,EACzB,6BAAoC;QAEpC,MAAM,QAAQ,GAAG,IAAI,CAAC,iCAAiC,CAAC,KAAK,CAAC,CAAC;QAC/D,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,GAAG,QAAQ,CAAC;QAC5C,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,GAAG,6BAA6B,CAAC;QAEjE,OAAO;YACH,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;YAChC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;SACnC,CAAC;IACN,CAAC;IAED,iCAAiC,CAAC,KAAyB;QACvD,OAAO;YACH,CAAC,EAAE,KAAK,CAAC,KAAK;YACd,CAAC,EAAE,KAAK,CAAC,KAAK;SACjB,CAAC;IACN,CAAC;IAED,iBAAiB,CAAC,KAAyB;QACvC,OAAO,IAAI,CAAC,wCAAwC,CAAC,KAAK,EAAE,IAAI,CAAC,6BAA6B,CAAC,CAAC;IACpG,CAAC;CACJ;AA1ED,wEA0EC","sourcesContent":["/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\nimport { MouseEvent } from 'react';\n\nimport type { Point } from 'src/types';\n\nexport class RelativeCursorPositionObserver {\n    protected _subject?: HTMLElement;\n\n    protected elementOffset?: Point;\n\n    get subject(): HTMLElement | undefined {\n        return this._subject;\n    }\n\n    set subject(value: HTMLElement | undefined) {\n        this._subject = value;\n    }\n\n    get documentRelativeElementOffset(): Point {\n        if (!this._subject) {\n            throw new Error('Not yet initialized. Subject is not set');\n        }\n\n        if (!this.elementOffset) {\n            this.elementOffset = this.getDocumentRelativeElementOffset(this._subject);\n        }\n\n        return this.elementOffset;\n    }\n\n    getDocumentRelativeElementOffset(el: HTMLElement): Point {\n        const rootEl = this.getRootOfEl(el);\n        const {\n            left: docLeft,\n            top: docTop,\n        } = rootEl.getBoundingClientRect();\n\n        const {\n            left: elLeft,\n            top: elTop,\n        } = el.getBoundingClientRect();\n\n        return {\n            x: Math.abs(docLeft) + elLeft,\n            y: Math.abs(docTop) + elTop,\n        };\n    }\n\n    getRootOfEl(el: HTMLElement): HTMLElement {\n        if (el.parentElement) {\n            return this.getRootOfEl(el.parentElement);\n        }\n        return el;\n    }\n\n    getComputedElementRelativeCursorPosition(\n        event: MouseEvent | Touch,\n        documentRelativeElementOffset: Point,\n    ): Point {\n        const position = this.getDocumentRelativeCursorPosition(event);\n        const { x: cursorX, y: cursorY } = position;\n        const { x: offsetX, y: offsetY } = documentRelativeElementOffset;\n\n        return {\n            x: Math.round(cursorX - offsetX),\n            y: Math.round(cursorY - offsetY),\n        };\n    }\n\n    getDocumentRelativeCursorPosition(event: MouseEvent | Touch): Point {\n        return {\n            x: event.pageX,\n            y: event.pageY,\n        };\n    }\n\n    getCursorPosition(event: MouseEvent | Touch): Point {\n        return this.getComputedElementRelativeCursorPosition(event, this.documentRelativeElementOffset);\n    }\n}\n"]}