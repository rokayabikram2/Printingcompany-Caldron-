{"version":3,"file":"CursorPosition.js","sourceRoot":"","sources":["../../src/CursorPosition.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    HTMLProps,\n    KeyboardEvent,\n    MouseEvent as ReactMouseEvent,\n    TouchEvent,\n    useEffect,\n    useRef,\n    useState,\n} from 'react';\nimport useResizeObserver from '@react-hook/resize-observer';\n\nimport {\n    INTERACTIONS,\n    MOUSE_EMULATION_GUARD_TIMER_NAME,\n} from 'src/constants';\nimport { noop } from 'src/utils';\nimport { TouchActivation } from 'src/lib/TouchActivation';\nimport { HoverActivation } from 'src/lib/HoverActivation';\nimport { ClickActivation } from 'src/lib/ClickActivation';\nimport { TapActivation } from 'src/lib/TapActivation';\nimport { PressActivation } from 'src/lib/PressActivation';\nimport { RelativeCursorPositionObserver } from 'src/lib/RelativeCursorPositionObserver';\nimport { TouchEnvironmentActivation } from 'src/lib/TouchEnvironmentActivation';\nimport { MouseEnvironmentActivation } from 'src/lib/MouseEnvironmentActivation';\nimport type {\n    ActivationChangeEvent,\n    ContainerDimensions,\n    DetectedInputType,\n    Interactions,\n    OnIsActiveChangedHandler,\n    Point,\n    PositionChangeEvent,\n    TimerHandle,\n} from 'src/types';\n\nexport type ChildProps = {\n    isActive: boolean;\n    isPositionOutside: boolean;\n    elementDimensions: ContainerDimensions;\n    position: Point;\n};\n\n// TODO remove RelativeCursorPositionObserver - it's not useful and just makes the package larger\nexport interface PropTypes extends HTMLProps<HTMLDivElement> {\n    activationInteractionMouse: Interactions['click'] | Interactions['hover'];\n    activationInteractionTouch: Interactions['press'] | Interactions['tap'] | Interactions['touch'];\n    children: (props: ChildProps) => JSX.Element;\n    hoverDelayInMs?: number;\n    hoverOffDelayInMs?: number;\n    isEnabled?: boolean;\n    onActivationChanged?: (event: ActivationChangeEvent) => void;\n    onDetectedEnvironmentChanged?: (detectedInputType: DetectedInputType) => void;\n    onOutsideClick: (e: MouseEvent) => void;\n    onPositionChanged?: (event: PositionChangeEvent) => void;\n    pressDurationInMs?: number;\n    pressMoveThreshold?: number;\n    shouldStopTouchMovePropagation?: boolean;\n    tabIndex?: number;\n    tapDurationInMs?: number;\n    tapMoveThreshold?: number;\n    useCapture?: boolean;\n}\n\n// TODO move to utils\nconst getTouchActivationStrategy = (\n    interaction: string,\n    onIsActiveChanged: OnIsActiveChangedHandler,\n    pressDurationInMs: number,\n    pressMoveThreshold: number,\n    tapDurationInMs: number,\n    tapMoveThreshold: number,\n): TouchEnvironmentActivation => {\n    const {\n        touch,\n        tap,\n        press,\n    } = INTERACTIONS;\n\n    switch (interaction) {\n        case press:\n            return new PressActivation({\n                onIsActiveChanged,\n                pressDurationInMs,\n                pressMoveThreshold,\n            });\n        case tap:\n            return new TapActivation({\n                onIsActiveChanged,\n                tapDurationInMs,\n                tapMoveThreshold,\n            });\n        case touch:\n            return new TouchActivation({\n                onIsActiveChanged,\n            });\n        default:\n            throw new Error('Must implement a touch activation strategy');\n    }\n};\n\nconst getMouseActivationStrategy = (\n    interaction: string,\n    onIsActiveChanged: OnIsActiveChangedHandler,\n    hoverDelayInMs: number,\n    hoverOffDelayInMs: number,\n): MouseEnvironmentActivation => {\n    const {\n        hover,\n        click,\n    } = INTERACTIONS;\n\n    switch (interaction) {\n        case hover:\n            return new HoverActivation({\n                onIsActiveChanged,\n                hoverDelayInMs,\n                hoverOffDelayInMs,\n            });\n        case click:\n            return new ClickActivation({\n                onIsActiveChanged,\n            });\n        default:\n            throw new Error('Must implement a mouse activation strategy');\n    }\n};\n\nconst getElementDimensions = (rect: DOMRectReadOnly): ContainerDimensions => {\n    const {\n        width,\n        height,\n    } = rect;\n\n    return {\n        width,\n        height,\n    };\n};\n\nconst getIsPositionOutside = (pos: Point, elementDimensions: ContainerDimensions): boolean => {\n    const { x, y } = pos;\n    const {\n        width,\n        height,\n    } = elementDimensions;\n\n    return (\n        x < 0\n        || y < 0\n        || x > width\n        || y > height\n    );\n};\n\nconst getTouchEvent = (e: TouchEvent): Touch => e.touches[0] as Touch;\n\nexport const CursorPosition = (props: PropTypes): JSX.Element => {\n    const {\n        activationInteractionMouse,\n        activationInteractionTouch,\n        children,\n        hoverDelayInMs = 250,\n        hoverOffDelayInMs = 150,\n        isEnabled = true,\n        onActivationChanged = noop,\n        onDetectedEnvironmentChanged = noop,\n        onOutsideClick,\n        onPositionChanged: onPositionChangedProp = noop,\n        pressDurationInMs = 500,\n        pressMoveThreshold = 5,\n        shouldStopTouchMovePropagation = false,\n        style,\n        tabIndex = -1,\n        tapDurationInMs = 180,\n        tapMoveThreshold = 5,\n        useCapture,\n        ...rest\n    } = props;\n\n    ///\n    /// Refs\n    ///\n\n    const observer = useRef(new RelativeCursorPositionObserver());\n    const divRef = useRef<HTMLDivElement>(null);\n    const timersRef = useRef<TimerHandle[]>([]);\n\n    ///\n    /// State\n    ///\n\n    const [elementDimensions, setElementDimensions] = useState<ContainerDimensions>({\n        width: 0,\n        height: 0,\n    });\n    const [\n        shouldGuardAgainstMouseEmulationByDevices,\n        setShouldGuardAgainstMouseEmulationByDevices,\n    ] = useState<boolean>(false);\n    const [isActive, setIsActive] = useState<boolean>(false);\n    const [isPositionOutside, setIsPositionOutside] = useState<boolean>(true);\n    const [position, setPosition] = useState<Point>({\n        x: 0,\n        y: 0,\n    });\n\n    ///\n    /// Hooks\n    ///\n    useResizeObserver(divRef, (entry) => setElementDimensions(getElementDimensions(entry.contentRect)));\n\n    // TODO remove / replace\n    const handleIsActiveChanged = (event: ActivationChangeEvent): void => {\n        setIsActive(event.isActive);\n    };\n\n    const [touchActivation, setTouchActivation] = useState<TouchEnvironmentActivation>(\n        getTouchActivationStrategy(\n            activationInteractionTouch,\n            handleIsActiveChanged,\n            pressDurationInMs,\n            pressMoveThreshold,\n            tapDurationInMs,\n            tapMoveThreshold,\n        ),\n    );\n    const [mouseActivation, setMouseActivation] = useState<MouseEnvironmentActivation>(\n        getMouseActivationStrategy(\n            activationInteractionMouse,\n            handleIsActiveChanged,\n            hoverDelayInMs,\n            hoverOffDelayInMs,\n        ),\n    );\n\n    ///\n    /// Functions\n    ///\n\n    const unsetShouldGuardAgainstMouseEmulationByDevices = (): void => {\n        timersRef.current.push({\n            name: MOUSE_EMULATION_GUARD_TIMER_NAME,\n            id: setTimeout(() => {\n                setShouldGuardAgainstMouseEmulationByDevices(false);\n            }, 0),\n        });\n    };\n\n    const setPositionState = (newPosition: Point): void => {\n        setIsPositionOutside(getIsPositionOutside(newPosition, elementDimensions));\n        setPosition(newPosition);\n    };\n\n    const onMouseDetected = (): void => {\n        onDetectedEnvironmentChanged({\n            isTouchDetected: false,\n            isMouseDetected: true,\n        });\n    };\n\n    const handleTouchStart = (e: TouchEvent): void => {\n        onDetectedEnvironmentChanged({\n            isTouchDetected: true,\n            isMouseDetected: false,\n        });\n        setShouldGuardAgainstMouseEmulationByDevices(true);\n\n        const newPosition = observer.current.getCursorPosition(getTouchEvent(e));\n\n        setPositionState(newPosition);\n\n        touchActivation.touchStarted({ e, position: newPosition });\n    };\n\n    const handleMouseEnter = (e: ReactMouseEvent): void => {\n        if (shouldGuardAgainstMouseEmulationByDevices) {\n            return;\n        }\n\n        onMouseDetected();\n        setPositionState(observer.current.getCursorPosition(e));\n        mouseActivation.mouseEntered();\n    };\n\n    const handleTouchEnd = (): void => {\n        touchActivation.touchEnded();\n        unsetShouldGuardAgainstMouseEmulationByDevices();\n        // TODO destroy?\n    };\n\n    const handleTouchCancel = (): void => {\n        touchActivation.touchCanceled();\n        unsetShouldGuardAgainstMouseEmulationByDevices();\n        // TODO destroy?\n    };\n\n    const handleMouseLeave = (): void => {\n        mouseActivation.mouseLeft();\n        setIsPositionOutside(true);\n        // TODO destroy?\n    };\n\n    const handleTouchMove = (e: TouchEvent): void => {\n        const newPosition = observer.current.getCursorPosition(getTouchEvent(e));\n\n        touchActivation.touchMoved({ e, position: newPosition });\n\n        if (isActive) {\n            setPositionState(newPosition);\n            e.preventDefault();\n\n            if (shouldStopTouchMovePropagation) {\n                e.stopPropagation();\n            }\n        }\n    };\n\n    const handleMouseMove = (e: ReactMouseEvent): void => {\n        const newPosition = observer.current.getCursorPosition(e);\n\n        setPositionState(newPosition);\n    };\n\n    const handleClick = (e: ReactMouseEvent): void => {\n        setPositionState(observer.current.getCursorPosition(e));\n        mouseActivation.mouseClicked();\n        onMouseDetected();\n    };\n\n    const handleKeyDown = (e: KeyboardEvent<HTMLDivElement>): void => {\n        e.preventDefault();\n        setIsActive(true);\n    };\n\n    const handleKeyUp = (e: KeyboardEvent<HTMLDivElement>): void => {\n        e.preventDefault();\n        setIsActive(false);\n    };\n\n    const onDocumentMouseClick = (e: MouseEvent): void => {\n        const el = e.target;\n        const isDescendantOfRoot = divRef.current && el instanceof Node && divRef.current.contains(el);\n\n        if (!isDescendantOfRoot) {\n            onOutsideClick(e);\n        }\n    };\n\n    const removeEventListeners = (): void => {\n        document.removeEventListener('click', onDocumentMouseClick);\n    };\n\n    ///\n    /// Effects\n    ///\n\n    useEffect(() => {\n        removeEventListeners();\n\n        if (isEnabled) {\n            document.addEventListener('click', onDocumentMouseClick, { capture: useCapture });\n        }\n\n        return (): void => removeEventListeners();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [isEnabled]);\n\n    useEffect(() => {\n        if (divRef.current) {\n            observer.current.subject = divRef.current;\n\n            // setElementDimensions(getElementDimensions(divRef.current));\n        }\n    }, [divRef]);\n\n    useEffect(() => {\n        onPositionChangedProp({\n            isPositionOutside,\n            position,\n        });\n\n        onActivationChanged({ isActive });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [isActive]);\n\n    useEffect(() => {\n        onPositionChangedProp({\n            isPositionOutside,\n            position,\n        });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [isPositionOutside, position]);\n\n    useEffect(() => {\n        setTouchActivation(getTouchActivationStrategy(\n            activationInteractionTouch,\n            handleIsActiveChanged,\n            pressDurationInMs,\n            pressMoveThreshold,\n            tapDurationInMs,\n            tapMoveThreshold,\n        ));\n        setMouseActivation(getMouseActivationStrategy(\n            activationInteractionMouse,\n            handleIsActiveChanged,\n            hoverDelayInMs,\n            hoverOffDelayInMs,\n        ));\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n        activationInteractionMouse,\n        activationInteractionTouch,\n    ]);\n\n    return (\n        <div\n            ref={divRef}\n            role=\"button\"\n            style={{\n                ...style,\n                WebkitUserSelect: 'none',\n            }}\n            tabIndex={tabIndex}\n            onClick={isEnabled ? handleClick : undefined}\n            onKeyDown={isEnabled ? handleKeyDown : undefined}\n            onKeyUp={isEnabled ? handleKeyUp : undefined}\n            onMouseEnter={isEnabled ? handleMouseEnter : undefined}\n            onMouseLeave={isEnabled ? handleMouseLeave : undefined}\n            onMouseMove={isEnabled ? handleMouseMove : undefined}\n            onTouchCancel={isEnabled ? handleTouchCancel : undefined}\n            onTouchEnd={isEnabled ? handleTouchEnd : undefined}\n            onTouchMove={isEnabled ? handleTouchMove : undefined}\n            onTouchStart={isEnabled ? handleTouchStart : undefined}\n            {...rest}\n        >\n            {children({\n                isActive,\n                isPositionOutside,\n                elementDimensions,\n                position,\n            })}\n        </div>\n    );\n};\n"]}